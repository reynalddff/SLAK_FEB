<%- include ../partials/admin_layout/header.ejs %>
<%- include ../partials/admin_layout/sidebar.ejs %>

<!-- Main Content -->
<div class="main-content">
    <section class="section">
        <div class="section-header">
            <h1>Dashboard</h1>
        </div>
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12">
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <div class="card card-statistic-1">
                        <div class="card-icon bg-primary">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="card-wrap">
                            <div class="card-header">
                                <h4>Total Pengguna Aktif</h4>
                            </div>
                            <div class="card-body">
                                <%= user %>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <input type="hidden" id="RoleId" value="<%=RoleId %>">
                    <div class="card">
                        <div class="card-header">
                            <h4>Statistics Survey</h4>
                        </div>
                        <div class="card-body">
                            <div style="width: 45em;">
                                <canvas id="chartAduan"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-12">
                <div class="card card-primary">
                    <div class="card-header">
                        <h4>Daftar Peminjaman Kunci</h4>
                        <button class="btn btn-primary text-right">Pinjam Kunci
                            <i class="fas fa-key"></i></button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">Nama Peminjam</th>
                                        <th scope="col">Ruangan</th>
                                        <th scope="col">Tanggal Pinjam</th>
                                        <th scope="col">Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% peminjaman_kunci.forEach((pinjam, index) => { %>
                                    <tr>
                                        <th scope="row"><%= index + 1 %></th>
                                        <td><%= pinjam.User.nama_user %></td>
                                        <td><%= pinjam.Kunci.nama_ruangan %></td>
                                        <td><%= tanggal_pinjam %></td>
                                        <% if (pinjam.status_peminjaman === "dipinjam") { %>
                                        <td class="text-danger font-weight-bold">Masih dipinjam</td>
                                        <% } else { %>
                                        <td class="text-primary font-weight-bold">Sudah Dikembalikan</td>
                                        <% } %>
                                    </tr>
                                    <!-- <tr>
                                        <th scope="row">2</th>
                                        <td>Jacob</td>
                                        <td>Jacob</td>
                                        <td>Thornton</td>
                                        <td class="text-primary font-weight-bold">Sudah Dikembalikan</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">3</th>
                                        <td>Larry</td>
                                        <td>Larry</td>
                                        <td>the Bird</td>
                                        <td class="text-primary font-weight-bold">Sudah Dikembalikan</td>
                                    </tr> -->
                                    <% }) %>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-12">
                <div class="card card-primary">
                    <div class="card-header">
                        <h4>Daftar Pengajuan Aduan</h4>
                        <a href="/admin/aduan_lapor" class="btn btn-primary text-right">Menyelsaikan Aduan <i
                                class="fas fa-paper-plane"></i></a>
                    </div>
                    <div class="card-body">
                        <% if(aduans.length) { %>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">Nama Pengadu</th>
                                        <th scope="col">Status</th>
                                        <th scope="col">Deskripsi Aduan</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% aduans.forEach((aduan, index) => { %>
                                    <tr>
                                        <th scope="row"><%= index + 1 %></th>
                                        <td><%= aduan.User.nama_user %></td>
                                        <% if (aduan.status_aduan === 'belum') { %>
                                        <td class="text-danger text-capitalize font-weight-bold">Belum <br>
                                            diselsaikan
                                        </td>
                                        <% } else { %>
                                        <td class="text-primary text-capitalize font-weight-bold">Sudah <br>
                                            diselsaikan
                                        </td>
                                        <% } %>
                                        <td><%= aduan.deskripsi_aduan %></td>
                                    </tr>
                                    <% }) %>
                                </tbody>
                            </table>
                        </div>
                        <% } else { %>
                        <div class="text-center">
                            <h3 class="mt-3 mb-5">Belum ada aduan yang masuk </h3>
                            <img src="/images/svg/undraw_empty.svg" style="width:30rem" alt="">
                        </div>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<%- include ../partials/footer.ejs %>

<script>
    $(document).ready(function () {
        const RoleId = document.getElementById("RoleId").value;
        const url = `http://127.0.0.1:3000/api/aduan`;
        // const url = 'http://127.0.0.1:3000/operator/aduan_lapor/perMonth';
        $.ajax({
            url: url,
            contentType: "application/json",
            dataType: 'json',
            success: function (result) {
                console.log(result.dataByMonth);
                const ctx = document.getElementById("chartAduan").getContext('2d');
                const myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ["July", "Agustus"],
                        datasets: [{
                            label: 'Umum',
                            data: [10, 11],
                            borderWidth: 2,
                            backgroundColor: 'rgba(63,82,227,.8)',
                            borderWidth: 0,
                            borderColor: 'transparent',
                            pointBorderWidth: 0,
                            pointRadius: 3.5,
                            pointBackgroundColor: 'transparent',
                            pointHoverBackgroundColor: 'rgba(63,82,227,.8)',
                        }, {
                            label: 'Akademik',
                            data: [8, 3],
                            borderWidth: 2,
                            backgroundColor: 'rgba(75, 192, 192, .8)',
                            borderWidth: 0,
                            borderColor: 'transparent',
                            pointBorderWidth: 0,
                            pointRadius: 3.5,
                            pointBackgroundColor: 'transparent',
                            pointHoverBackgroundColor: 'rgba(75, 192, 192, .8)',
                        }, {
                            label: 'Keuangan dan Kepegawaian',
                            data: [8, 2],
                            borderWidth: 2,
                            backgroundColor: 'rgba(153, 102, 255, 0.8)',
                            borderWidth: 0,
                            borderColor: 'transparent',
                            pointBorderWidth: 0,
                            pointRadius: 3.5,
                            pointBackgroundColor: 'transparent',
                            pointHoverBackgroundColor: 'rgba(153, 102, 255, 0.8)',
                        }, {
                            label: 'Kemahasiswaan',
                            data: [8, 4],
                            borderWidth: 2,
                            backgroundColor: 'rgba(255, 159, 64, 0.8)',
                            borderWidth: 0,
                            borderColor: 'transparent',
                            pointBorderWidth: 0,
                            pointRadius: 3.5,
                            pointBackgroundColor: 'transparent',
                            pointHoverBackgroundColor: 'rgba(255, 159, 64, 0.8)',
                        }]
                    },
                    options: {
                        legend: {
                            display: false
                        },
                        scales: {
                            yAxes: [{
                                gridLines: {
                                    // display: false,
                                    drawBorder: false,
                                    color: '#f2f2f2',
                                },
                                ticks: {
                                    beginAtZero: true,
                                    stepSize: 0,
                                    callback: function (value, index, values) {
                                        return + value;
                                    }
                                }
                            }],
                            xAxes: [{
                                gridLines: {
                                    display: false,
                                    tickMarkLength: 15,
                                }
                            }]
                        },
                    }
                });
            }
        })
    });
</script>