<%- include ../../partials/karyawan_layout/header.ejs %>
<%- include ../../partials/karyawan_layout/sidebar.ejs %>

<!-- Main Content -->
<div class="main-content">
    <section class="section">
        <div class="section-header">
            <h1>Layanan: Pinjam Kunci</h1>
        </div>
        <% if (success.length > 0) { %>
        <div class="alert alert-primary alert-has-icon alert-dismissible show fade">
            <div class="alert-icon"><i class="fas fa-thumbs-up"></i></div>
            <div class="alert-body">
                <button class="close" data-dismiss="alert">
                    <span>Ã—</span>
                </button>
                <div class="alert-title">Success</div>
                <%= success %>
            </div>
        </div>
        <% } %>
        <% if (kunciDipinjam === null && menungguValidasi === null) { %>
        <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-12">
                <div class="card card-primary">
                    <div class="card-header">
                        <h4>Daftar Kunci</h4>
                    </div>
                    <div class="card-body">
                        <!-- Kurang datepicker aja -->
                        <div class="table-responsive">
                            <table id="example" class="table" style="width:100%">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Ruangan</th>
                                        <th>Status Kunci</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% kunci.forEach((kunci, index) => { %>
                                    <tr>
                                        <td> <%= index + 1 %> </td>
                                        <td><%= kunci.nama_ruangan %></td>
                                        <% if (kunci.status_kunci === "tersedia") {  %>
                                        <td>
                                            <div class="badge badge-primary">Tersedia</div>
                                        </td>
                                        <td><a href="/karyawan/pinjam_kunci/konfirmasi/<%= kunci.id %>"
                                                class="btn btn-primary">Pinjam Kunci</a></td>
                                        <% } else if (kunci.status_kunci === "renovasi") { %>
                                        <td>
                                            <div class="badge badge-warning">Renovasi</div>
                                        </td>
                                        <td><a href="pinjam_kunci_form.html"
                                                class="btn btn-secondary disabled">Pinjam</a></td>
                                        <% } else if (kunci.status_kunci === "dipinjam") { %>
                                        <td>
                                            <div class="badge badge-danger">Dipinjam</div>
                                        </td>
                                        <td><a href="pinjam_kunci_form.html"
                                                class="btn btn-secondary disabled">Pinjam</a></td>
                                        <% } else { %>
                                        <td>
                                            <div class="badge badge-dark">Tidak Tersedia</div>
                                        </td>
                                        <td><a href="pinjam_kunci_form.html"
                                                class="btn btn-secondary disabled">Pinjam</a></td>
                                        <% }  %>
                                    </tr>
                                    <%})%>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-12">
                <div class="card card-primary">
                    <div class="card-header">
                        <h4>Riwayat Peminjaman Kunci: <%= nama_user %></h4>
                    </div>
                    <div class="card-body">
                        <!-- Kurang datepicker aja -->
                        <div class="table-responsive">
                            <table id="example" class="table" style="width:100%">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Ruangan</th>
                                        <th>Tanggal Pinjam</th>
                                        <th>Tanggal Kembali</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% riwayatMinjamKunci.forEach((riwayat, index) => { %>
                                    <tr>
                                        <td> <%= index + 1 %> </td>
                                        <td><%= riwayat.Kunci.nama_ruangan %></td>
                                        <td><%= riwayat.tanggal_pinjam %></td>
                                        <td><%= riwayat.tanggal_kembali %></td>
                                        <% if (riwayat.status_peminjaman === 'dikembalikan'){ %>
                                        <td>
                                            <div class="badge badge-success">Sudah Dikembalikan</div>
                                        </td>
                                        <% } else { %>
                                        <td>
                                            <div class="badge badge-dark">Menunggu Validasi</div>
                                        </td>
                                        <%  } %>
                                    </tr>
                                    <%})%>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <% } else if (kunciDipinjam) { %>
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12">
                <div class="card card-warning">
                    <div class="card-header">
                        <h4>Daftar Kunci</h4>
                    </div>
                    <div class="card-body">
                        <div class="text-center">
                            <h3 class="mt-3 mb-4">
                                Kamu belum mengembalikan kunci, silahkan ke ruang satpam di Gedung Rektorat Lama lt 1
                                <br>
                                untuk mengembalikan kunci.
                            </h3>
                            <div class="img-svg">
                                <img src="/images/svg/undraw_things.svg" style="width:20rem" alt="">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <% } else if (menungguValidasi) { %>
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12">
                <div class="card card-warning">
                    <div class="card-header">
                        <h4>Daftar Kunci</h4>
                    </div>
                    <div class="card-body">
                        <div class="text-center">
                            <h3 class="mt-3 mb-4">
                                Peminjaman kunci sedang diproses. Jika proses dirasa lama, silahkan ke ruang satpam
                                <br>
                                di gedung Rektorat Lama lt 1
                            </h3>
                            <div class="img-svg">
                                <img src="/images/svg/undraw_things.svg" style="width:20rem" alt="">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <% } %>
</div>
</section>
</div>

<%- include ../../partials/footer.ejs %>